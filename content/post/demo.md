---
title: "错误排查"
date: 2023-11-29T19:48:31+08:00
draft: true
tags: []
categories: ["前端"]
---

排查问题的过程以及结果因为涉及到很多技术细节，这里就不啰嗦展开了，主要是针对排查中复盘自己几个错误的决定，导致浪费了额外的更多时间。

## 几个坑

### 问题的分析不够冷静

最起初即判断为是依赖升级导致的问题，但是没有从头追查到尾。在降级了部分依赖后，运行仍然失败的情况下，没有继续降级深层次依赖,转而去其他方向碰运气，尝试一些没有根据的手段来做修复（打包增加sourcemap,配置external），实际上并没有效果,只是增加了问题排查的复杂度。

总结下来排查问题应该是围绕事实情况，不要急于实验操作，而是多分析问题的原因，快速定位到问题真正所在解决问题也就很简单了。

### debug中也要减少手动操作

因为涉及到多个仓库，以及Lib构建，每次调试都要在10分钟以上。其中设计到文件拷贝替换，文件下载，以及代码修改依赖安装等多个手动步骤，当步骤操作错误时，会导致结果并不会实际生效。另外就是缺乏实验的记录，例如修改了a导致什么结果，修改了a+b造成何种结果。导致有多次重复实验，把修复时间整体拖得特别长。


## 学到的知识

### 构建工具多余pkg中exports的处理

虽然webpack或者一些其他构建工具都声明支持exports字段，但是实际使用中根据构建工具的版本不同，实际引入的文件也是不同的。有的会根据exports中的设置导入，有的只是根据import语句中的路径导入。

### pnpm&依赖管理

pnpm不同于yarn的组织方式，他会把所有依赖按照要求做嵌套，所以层次会很深，检索依赖的方式可以用`pnpm why -r`命令.

随着依赖层次的深入，管理依赖的成本也就越高，越容易失控，lock文件虽然能部分解决问题，但不是完全解决，尤其是在冲突或者有表层依赖升级时，容易触发很多包的升级。

包管理上有风险的包最好锁死版本，尤其是一些代码中违规使用的方式，未来包升级的时候更容易被废弃。

### 微前端

这个话题比较深入后面详聊。